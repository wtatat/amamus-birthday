<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í –ß–ï–°–¢–¨ –í–ï–õ–ò–ö–û–ì–û AMAMUS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        #click-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #aae5a4; display: flex; justify-content: center;
            align-items: center; z-index: 20000; cursor: pointer;
        }
        #click-text {
            font-family: "Verdana", sans-serif; font-size: 3em; font-weight: bold;
            color: #000099; text-transform: uppercase; letter-spacing: 5px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0.5; transform: scale(1); }
        }
        body {
            margin: 0; padding: 0; background-color: #aae5a4; color: #000;
            font-family: "Verdana", sans-serif; text-align: center;
            overflow-x: hidden; cursor: crosshair;
        }
        .header-bar {
            background-color: #aae5a4; height: 60px; width: 100%;
            position: fixed; top: 0; left: 0; z-index: 10000;
            display: flex; align-items: center; padding-left: 20px;
            border-bottom: 1px solid #7cb576;
        }
        .header-logo { color: #000099; font-weight: bold; font-size: 2em; text-decoration: none; }
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        .manul { position: absolute; pointer-events: none; opacity: 0.6; user-select: none; }
        .manul-bg { animation: fall linear infinite; }
        .manul-cursor { animation: fall-and-fade linear forwards; }
        @keyframes fall {
            0% { transform: translateY(-150px) rotate(0deg); }
            100% { transform: translateY(110vh) rotate(360deg); }
        }
        @keyframes fall-and-fade {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.9; }
            100% { transform: translateY(500px) rotate(180deg); opacity: 0; }
        }
        .section {
            min-height: 100vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 80px 20px 40px 20px;
            position: relative; z-index: 10; border-bottom: 1px solid #7cb576;
        }
        .main-photo, .section-img { width: 400px; border: 3px solid #000099; margin: 20px 0; background-color: #fff; }
        h1 { font-size: 3.5em; color: #000099; margin-bottom: 10px; }
        p { font-size: 1.5em; font-weight: bold; margin-top: 10px; }
        
        .comments-container { width: 100%; max-width: 800px; text-align: left; background-color: #aae5a4; }
        .comment-item { padding: 10px; border-bottom: 1px solid #7cb576; margin-bottom: 10px; font-size: 0.9em; position: relative; }
        
        .reply-item { margin-left: 40px; border-left: 2px solid #000099; background: rgba(0,0,153, 0.05); }
        .comment-img { max-width: 300px; border: 1px solid #000099; margin-top: 10px; display: block; border-radius: 4px; }
        .reply-btn { color: #000099; cursor: pointer; text-decoration: underline; font-size: 0.8em; margin-left: 10px; }
        .reply-to-info { background: #eee; padding: 5px; margin-bottom: 10px; display: none; font-size: 0.8em; border: 1px solid #7cb576; }

        .comment-header { color: #000099; font-weight: bold; }
        .comment-meta { color: #000; font-weight: bold; font-size: 0.85em; }
        .comment-body { margin-top: 8px; color: #000; font-size: 1.1em; }
        .vote-link { color: #000099; text-decoration: underline; cursor: pointer; }
        
        .add-comment-form {
            width: 100%; max-width: 800px; margin-top: 30px; text-align: left;
            padding: 15px; border: 1px solid #7cb576; background: rgba(255,255,255,0.1);
        }
        .add-comment-form input, .add-comment-form textarea {
            width: 100%; box-sizing: border-box; border: 1px solid #7cb576;
            padding: 10px; font-family: Verdana; margin-bottom: 10px;
        }
        .add-comment-form button {
            background-color: #eee; border: 1px solid #7cb576; padding: 5px 15px;
            cursor: pointer; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="click-overlay" onclick="startSite()">
        <div id="click-text">–ö–õ–ò–ö</div>
    </div>

    <audio id="bgMusic" loop>
        <source src="72. Heahea City (Night).mp3" type="audio/mpeg">
    </audio>

    <div class="header-bar">
        <div class="header-logo">AMAMUS 34</div>
    </div>

    <div id="snow-container"></div>

    <div class="section">
        <img src="AMAMUS.jpg" alt="AMAMUS" class="main-photo">
        <h2 style="color: #000; font-weight: bold; font-size: 2.5em;">–ü–æ–º–Ω–∏–º, –ª—é–±–∏–º, —Å–∫–æ—Ä–±–∏–º</h2>
    </div>

    <section class="section">
        <h1 style="color: #c00;">üéÑ –° –ù–û–í–´–ú –ì–û–î–û–ú!!! üéÑ</h1>
        <img src="ng.jpg" alt="–ù–æ–≤—ã–π –ì–æ–¥" class="section-img">
        <p>–π–æ—É –π–æ—É.</p>
    </section>

    <section class="section">
        <h1 style="color: #856404;">üçù –î–ï–ù–¨ –°–ü–ê–ì–ï–¢–¢–ò –í –°–®–ê üá∫üá∏</h1>
        <img src="spagetti.jpg" alt="–°–ø–∞–≥–µ—Ç—Ç–∏" class="section-img">
        <p>National Spaghetti Day!!!</p>
    </section>

    <section class="section">
        <h1 style="color: #d0157a;">üå∏ –ù–ê–°–¢–ê–°–¨–ò–ù –î–ï–ù–¨</h1>
        <img src="babka.jpg" alt="–ù–∞—Å—Ç–∞—Å—å—è" class="section-img">
        <p>–°–ª–∞–≤–∏–º –≤–µ–ª–∏–∫–æ–º—É—á–µ–Ω–∏—Ü—É –ê–Ω–∞—Å—Ç–∞—Å–∏—é –ó–µ–º–ª–µ—Ä–æ–π–∫—É.</p>
    </section>

    <section class="section">
        <h1 style="color: #006400;">–î–ï–ù–¨ –ù–ï–ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ú–¨–Ø–ù–ú–´</h1>
        <p>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –æ—Ç –≤—Å–µ–≥–æ —Å–µ—Ä–¥—Ü–∞!</p>
    </section>

    <section class="section">
        <h1 style="color: #000099;">‚†É‚†ó‚†á –í–°–ï–ú–ò–†–ù–´–ô –î–ï–ù–¨ –ê–ó–ë–£–ö–ò –ë–†–ê–ô–õ–Ø</h1>
        <p>‚†é‚†ï‚†é‚†ä‚†Ä‚†é‚†ï‚†é‚†ä‚†Ä‚†è‚†ï‚†é‚†ï‚†é‚†ä</p>
    </section>

    <div class="section">
        <h2 style="color: #000099; font-size: 2.5em;">–ó–ê–°–õ–£–ì–ò (<span id="comment-count">3</span>)</h2>
        <div class="comments-container" id="comment-list">
            <div class="comment-item">
                <div class="comment-header">Stupidugly83 <span style="color: #777; font-weight: normal;"> >> #34821885</span></div>
                <div class="comment-meta">Posted on 2026-01-03 04:09:24 Score: 1488 (<span class="vote-link">vote Up</span>)</div>
                <div class="comment-body">–î–æ–∫—Å–∏–Ω–≥ —É–º–∏—Ä–∞—é—â–µ–π –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä–∫–∏</div>
            </div>
            <div class="comment-item">
                <div class="comment-header">Anon_Manul_Lover <span style="color: #777; font-weight: normal;"> >> #34821886</span></div>
                <div class="comment-meta">Posted on 2026-01-03 04:10:12 Score: 228 (<span class="vote-link">vote Up</span>)</div>
                <div class="comment-body">–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –±—é–¥–∂–µ—Ç–∞ –¥–µ—Ç—Å–∫–æ–≥–æ —Å–∞–¥–∞ —Å –ø–æ–º–æ—â—å—é –∞—Ä–º–∏–∏ –≥–æ–ª—É–±–µ–π</div>
            </div>
            <div class="comment-item">
                <div class="comment-header">Grandpa_Hater <span style="color: #777; font-weight: normal;"> >> #34821887</span></div>
                <div class="comment-meta">Posted on 2026-01-03 04:11:05 Score: 666 (<span class="vote-link">vote Up</span>)</div>
                <div class="comment-body">–ü–æ–¥—Ä—ã–≤ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ–≥–æ –∫—Ä–µ—Å–ª–∞ –°–í–û–µ–≥–æ –¥–µ–¥—É—à–∫–∏</div>
            </div>
        </div>

        <div class="add-comment-form" id="comment-form-anchor">
            <div id="reply-indicator" class="reply-to-info">
                –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ <span id="reply-target-id"></span> 
                <span style="color:red; cursor:pointer;" onclick="cancelReply()">[–û—Ç–º–µ–Ω–∞]</span>
            </div>

            <div style="color: #000099; font-weight: bold; margin-bottom: 5px;">–í–∞—à –Ω–∏–∫ (–∑–∞–ø–æ–º–Ω–∏—Ç—Å—è):</div>
            <input type="text" id="nickname-input" placeholder="HPPY_BRDY_:)))">
            <div style="color: #000099; font-weight: bold; margin-bottom: 5px;">–¢–µ–∫—Å—Ç –∑–∞—Å–ª—É–≥–∏:</div>
            <textarea id="comment-input" placeholder="Enter your merit here..."></textarea>
            
            <div style="margin-bottom: 10px;">
                <div style="color: #000099; font-weight: bold; margin-bottom: 5px;">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ:</div>
                <input type="file" id="file-input" accept="image/*">
            </div>

            <button id="post-btn" onclick="addComment()">Post comment</button>
            <span id="loading-text" style="display:none; font-size:0.8em; color:#000099; margin-left:10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
    </div>

    <script>
        const SB_URL = 'https://wiqptoiikgjvjtwzpxjd.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpcXB0b2lpa2dqdmp0d3pweGpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NDE4MzIsImV4cCI6MjA4MzAxNzgzMn0.OeNZKRx-FZN6Mjw9-kuPYy2HEA6Xkb-Sf6xRlscTMUc';
        const sbClient = supabase.createClient(SB_URL, SB_KEY);

        const imgPath = 'manul.jpg';
        const audio = document.getElementById('bgMusic');
        let currentReplyId = null;

        // –π–æ—É –π–æ—É
        const savedNick = localStorage.getItem('user_nickname');
        if (savedNick) document.getElementById('nickname-input').value = savedNick;

        async function loadComments() {
            const { data, error } = await sbClient
                .from('comments')
                .select('*')
                .order('created_at', { ascending: true });

            if (data) {
                // –π–æ—É–π –æ—É –π–æ—É
                const list = document.getElementById('comment-list');
                const mainComments = data.filter(c => !c.parent_id);
                const replies = data.filter(c => c.parent_id);

                data.forEach(c => {
                    
                });
                const staticCount = 3; 
                mainComments.forEach(c => {
                    renderNewComment(c, false);
                    replies.filter(r => r.parent_id == c.id).forEach(r => renderNewComment(r, true));
                });
                
                document.getElementById('comment-count').innerText = staticCount + data.length;
            }
        }

        function renderNewComment(c, isReply) {
            const list = document.getElementById('comment-list');
            const div = document.createElement('div');
            div.className = 'comment-item' + (isReply ? ' reply-item' : '');
            const time = new Date(c.created_at).toLocaleString();
            let imgHtml = c.image_url ? `<img src="${c.image_url}" class="comment-img">` : '';
            
            div.innerHTML = `
                <div class="comment-header">${c.author_name} <span style="color: #777; font-weight: normal;"> >> #${c.random_id}</span></div>
                <div class="comment-meta">
                    Posted on ${time} Score: 0 
                    (<span class="vote-link" onclick="prepareReply('${c.id}', '${c.random_id}')">–û—Ç–≤–µ—Ç–∏—Ç—å</span>)
                </div>
                <div class="comment-body">${c.content}</div>
                ${imgHtml}
            `;
            list.appendChild(div);
        }

        function prepareReply(id, rid) {
            currentReplyId = id;
            document.getElementById('reply-indicator').style.display = 'block';
            document.getElementById('reply-target-id').innerText = '#' + rid;
            document.getElementById('comment-form-anchor').scrollIntoView();
        }

        function cancelReply() {
            currentReplyId = null;
            document.getElementById('reply-indicator').style.display = 'none';
        }

        async function addComment() {
            const nickInput = document.getElementById('nickname-input');
            const textInput = document.getElementById('comment-input');
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            
            const nick = nickInput.value.trim() || "Anonymous";
            const text = textInput.value.trim();
            
            if (!text && !file) return;

            document.getElementById('post-btn').disabled = true;
            document.getElementById('loading-text').style.display = 'inline';

            let uploadedImageUrl = null;

            if (file) {
                const fileName = `${Date.now()}_${file.name}`;
                const { data: upData, error: upError } = await sbClient.storage
                    .from('comment-images')
                    .upload(fileName, file);

                if (!upError) {
                    const { data: urlData } = sbClient.storage
                        .from('comment-images')
                        .getPublicUrl(fileName);
                    uploadedImageUrl = urlData.publicUrl;
                }
            }

            localStorage.setItem('user_nickname', nick);
            const randomID = Math.floor(Math.random() * 99999999);

            const { error } = await sbClient
                .from('comments')
                .insert([{ 
                    author_name: nick, 
                    content: text, 
                    random_id: randomID.toString(),
                    parent_id: currentReplyId,
                    image_url: uploadedImageUrl
                }]);

            if (!error) {
                textInput.value = "";
                fileInput.value = "";
                // –æ—É –π–æ—É
                location.reload(); 
            } else {
                alert("–û—à–∏–±–∫–∞: " + error.message);
                document.getElementById('post-btn').disabled = false;
                document.getElementById('loading-text').style.display = 'none';
            }
        }

        function startSite() {
            document.getElementById('click-overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            window.scrollTo(0, 0);
            audio.volume = 0;
            audio.play();
            let fadeInterval = setInterval(() => {
                if (audio.volume < 0.95) audio.volume += 0.05;
                else { audio.volume = 1; clearInterval(fadeInterval); }
            }, 200);
            loadComments();
        }

        document.body.style.overflow = 'hidden';

        // –±–ª—è–¥—Å–∫–æ–µ —Ñ–ª–∞–º–∏–Ω–≥–æ.
        for (let i = 0; i < 25; i++) {
            const m = document.createElement('img');
            m.src = imgPath;
            m.className = 'manul manul-bg';
            m.style.width = (Math.random() * 60 + 40) + 'px';
            m.style.left = Math.random() * 100 + 'vw';
            m.style.animationDuration = (Math.random() * 5 + 4) + 's';
            m.style.animationDelay = Math.random() * 5 + 's';
            document.getElementById('snow-container').appendChild(m);
        }

        document.addEventListener('mousemove', (e) => {
            if (Math.random() > 0.8) { 
                const m = document.createElement('img');
                m.src = imgPath;
                m.className = 'manul manul-cursor';
                m.style.width = '24px'; 
                m.style.left = e.pageX + 'px';
                m.style.top = e.pageY + 'px';
                m.style.position = 'absolute';
                const fallTime = 1.5;
                m.style.animationDuration = fallTime + 's';
                document.body.appendChild(m);
                setTimeout(() => { m.remove(); }, fallTime * 1000);
            }
        });
    </script>
</body>
</html>
